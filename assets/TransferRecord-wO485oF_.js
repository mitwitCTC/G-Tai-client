import{u as P,a as n,o as w,p as L,q as Q,c as d,f as r,g as m,w as f,t as h,e as X,s as B,d as Y,x as Z,b as y,r as ee,h as M,v as te,i as o,F as ae,k as ne}from"./index-CVTk_Qop.js";const oe={class:"container mt-5"},le={class:"d-flex justify-content-between align-items-center"},re={class:"d-flex justify-content-between"},se={key:0},ce={key:0},ue={key:1},ie={key:2},de={key:3},pe={class:"my-3"},_e=`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `,ve={__name:"TransferRecord",setup(me){const k=P(),x=new Date,q=x.getFullYear(),A=n(String(x.getMonth()+1).padStart(2,"0")),u=n(`${q}-${A.value}`),i=n(""),S=n("");async function j(){try{const e=await y.post("/main/lastUpdateTime",{customerId:k.company_info.customerId});S.value=e.data.data}catch(e){console.error(e)}}w(()=>{j()});const v=n(!1),T=n(!1),s=n({}),F=L(()=>{if(g.value==1){const e=i.value==1?12:i.value-1;return[{label:`${i.value}月份餘額`,prop:"current_month_balance"},{label:"",prop:"equal_sign"},{label:`${e}月份餘額`,prop:"last_month_balance"},{label:"",prop:"plus_sign"},{label:`${i.value}月份匯款`,prop:"current_month_remittance_amount"},{label:"",prop:"minus_sign"},{label:`${i.value}月份加油小計`,prop:"current_month_fuel_total"}]}else if(g.value==2)return[...Object.keys(s.value).filter(e=>e!=="payment_deadline").map(e=>({label:e,prop:e})),{label:"款項繳費期限",prop:"payment_deadline"}];return[]});function U(){u.value?i.value=u.value.split("-")[1]:i.value=""}const C=n("");async function E(){if(U(),g.value==1){v.value=!0;try{const e=await y.post("/main/monthlyBalance",{date:u.value,customerId:k.company_info.customerId});s.value.current_month_balance=c(Number(e.data.data[0].thisMonthOverage)),s.value.last_month_balance=c(Number(e.data.data[0].overage)),s.value.current_month_remittance_amount=c(Number(e.data.data[0].creditAmount)),s.value.current_month_fuel_total=c(Number(e.data.data[0].salesAmount))}catch(e){console.error(e)}finally{v.value=!1}}else if(g.value==2){v.value=!0;try{const e=await y.post("/main/collateralInfo",{cus_code:k.company_info.customerId});C.value=e.data.data[0].config_notes,O(C.value);const t=e.data.data[0].remittance_date;s.value.payment_deadline=`每月${t}日前`}catch(e){console.error(e)}finally{v.value=!1}}}function O(e){const t={};e.split(", ").forEach(b=>{const[l,p]=b.split(":"),_=p.match(/^(\d+)(?:\s*[([\s]?([^()[\]]+)[)\]]?)?$/);t[l.trim()]=_?`${c(Number(_[1]))} ${_[2]?`(${_[2]})`:""}`:p.trim()}),s.value=t}const g=n("");function R(){g.value=sessionStorage.getItem("token")}w(()=>{R()});const G=n(2e5),$=n([]);async function N(){E(),T.value=!0;try{const e=await y.post("/main/remittanceRecord",{date:u.value,customerId:k.company_info.customerId});$.value=e.data.data,$.value=e.data.data.map(t=>({scheduled_date:W(Number(t.account_date)),checkoutTime:t.checkoutTime==="0"?"":t.checkoutTime.replace(/\//g,"-"),remittance_amount:c(Number(t.amount)),note:D[t.trading_model]||t.trading_model}))}catch(e){console.error(e)}finally{T.value=!1}}function W(e){const t=Math.floor(e/1e4),b=Math.floor(e%1e4/100),l=e%100;return`${t+1911}-${String(b).padStart(2,"0")}-${String(l).padStart(2,"0")}`}const I=n([]);async function z(){try{const e=await y.get("/main/tradingModel");I.value=e.data.data}catch(e){console.error(e)}}w(()=>{z()});const D=L(()=>I.value.reduce((e,t)=>(e[t.trading_model_code]=t.trading_model_des,e),{}));Q(u,()=>{N()}),w(()=>{N()});function c(e){return typeof e=="number"?e.toLocaleString("en-US"):e}function H(){sessionStorage.clear(),ee.push("/login")}return(e,t)=>{const b=M("router-link"),l=M("el-table-column"),p=M("el-table"),_=M("el-date-picker"),V=te("loading");return o(),d("div",oe,[r("div",le,[m(b,{to:"/"},{default:f(()=>t[1]||(t[1]=[r("button",{class:"btn btn-yellow mb-2"},"回首頁",-1)])),_:1}),r("button",{class:"btn btn-yellow",onClick:H},"登出")]),r("p",re,[t[2]||(t[2]=r("span",{class:"fw-bold"},"匯款紀錄查詢",-1)),S.value!="無最後更新時間"?(o(),d("span",se,"結帳時間："+h(S.value),1)):X("",!0)]),t[3]||(t[3]=r("p",null,"*以下匯款明細，會因匯款入帳作業有 2 - 3 工作天的差異",-1)),B((o(),Y(p,{class:"mb-3",border:"",data:[s.value]},{default:f(()=>[(o(!0),d(ae,null,ne(F.value,(a,J)=>(o(),Y(l,{align:"center","min-width":a.prop==="equal_sign"||a.prop==="plus_sign"||a.prop==="minus_sign"?"50":"130",key:J,label:a.label},{default:f(K=>[a.prop==="equal_sign"?(o(),d("span",ce,"=")):a.prop==="plus_sign"?(o(),d("span",ue,"+")):a.prop==="minus_sign"?(o(),d("span",ie,"-")):(o(),d("span",de,h(K.row[a.prop]),1))]),_:2},1032,["min-width","label"]))),128))]),_:1},8,["data"])),[[V,v.value]]),t[4]||(t[4]=Z(" 查詢帳戶月份： ")),m(_,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),type:"month",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"請選擇查詢帳戶月份",onChange:N},null,8,["modelValue"]),r("p",pe,"安全值金額："+h(c(G.value)),1),B((o(),Y(p,{data:$.value,stripe:"",height:"350","element-loading-text":"資料載入中...","element-loading-spinner":_e,"element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(122, 122, 122, 0.8)"},{default:f(()=>[m(l,{align:"center",prop:"scheduled_date",label:"交易日"}),m(l,{align:"center",prop:"checkoutTime",label:"結帳日"}),m(l,{align:"center",prop:"remittance_amount",label:"匯款金額"},{default:f(({row:a})=>[r("span",null,h(c(a.remittance_amount)),1)]),_:1}),m(l,{align:"center",prop:"note",label:"交易方式"},{default:f(({row:a})=>[r("span",null,h(D.value[a.note]),1)]),_:1})]),_:1},8,["data"])),[[V,T.value]])])}}};export{ve as default};
