import{_ as F,u as I,o as k,r as c,a as i,b as h,c as B,d as L,e as N,f as n,g as l,w as m,F as S,h as d,i as g,j}from"./index-CVTk_Qop.js";import{a as q}from"./apiServer-CD3olmFD.js";const K={class:"container position-relative d-flex justify-content-center"},T={class:"login-form mt-5 w-50"},U={class:"d-flex justify-content-center"},$={class:"w-100 text-center"},E={__name:"LoginView",setup(M){const b=I();k(()=>{if(c.currentRoute.value.query.cca){const e=atob(c.currentRoute.value.query.cca),o=atob(c.currentRoute.value.query.dwp);e&&o&&(t.value.account=e,t.value.password=o,p())}});const t=i({account:"",password:""}),a=i(""),y=i("");async function p(){try{const{account:e,password:o}=t.value,_=await h.post("/main/logIn",{vat_number:e,front_pwd:o}),{returnCode:u,message:r,data:v}=_.data;if(u===0){const{contract_status:s,cus_code:R,transaction_mode:x}=v[0];s!=="Y"?(a.value="登入成功",y.value=R,C(),sessionStorage.setItem("token",x),c.push("/")):w("登入失敗")}else w(r)}catch(e){console.error(e)}V()}function w(e){a.value=e,setTimeout(()=>{a.value=""},2e3)}function V(){setTimeout(()=>{a.value=""},2e3)}const f=i({});async function C(){try{const e=await q.post("/main/searchCustomer",{cus_code:y.value});f.value.customerId=e.data.data[0].cus_code,f.value.customerName=e.data.data[0].cus_name,b.setCompanyInfo(f.value)}catch(e){console.error(e)}}return(e,o)=>{const _=d("el-alert"),u=d("el-input"),r=d("el-form-item"),v=d("el-form");return g(),B(S,null,[a.value?(g(),L(_,{key:0,title:a.value,type:a.value=="登入成功"?"success":"error","show-icon":"",class:"position-absolute"},null,8,["title","type"])):N("",!0),n("div",K,[n("div",T,[o[4]||(o[4]=n("h1",{class:"text-center my-3"},"鉅泰創新",-1)),n("div",U,[l(v,{ref:"loginFormRef",model:t.value},{default:m(()=>[l(r,{label:"帳號",prop:"account"},{default:m(()=>[l(u,{modelValue:t.value.account,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.account=s),type:"text",autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(r,{label:"密碼",prop:"password"},{default:m(()=>[l(u,{modelValue:t.value.password,"onUpdate:modelValue":o[1]||(o[1]=s=>t.value.password=s),type:"password",autocomplete:"off",onKeydown:o[2]||(o[2]=j(s=>p(e.loginFormRef),["enter"]))},null,8,["modelValue"])]),_:1}),l(r,null,{default:m(()=>[n("div",$,[n("button",{type:"button",class:"btn btn-warning",onClick:o[3]||(o[3]=s=>p(e.loginFormRef))}," 登入 ")])]),_:1})]),_:1},8,["model"])])])])],64)}}},A=F(E,[["__scopeId","data-v-03ee827a"]]);export{A as default};
